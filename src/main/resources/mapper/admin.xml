<?xml version="1.0" encoding="UTF-8"?>
<!-- 24.02.29 관리자 페이지 xml -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guideyou.repository.interfaces.admin.AdminRepository">
	
	<!-- 최근 생성된 상품 정보 조회 -->
	<select id="findLatestPosts" resultType="com.guideyou.dto.product.ProductDto">
		SELECT u.nickname as nickName, p.id, p.user_id as userId, p.title, p.price, p.created_at as createdAt
        FROM product p
        JOIN user u ON p.user_id = u.id
        ORDER BY p.created_at DESC
	</select>
	
	<!-- 인기 상품 조회 -->
	<select id="findProductInfo" resultType="com.guideyou.dto.product.ProductDto">
		SELECT p.id AS productId,
	       p.intro_content,
	       p.content,
	       p.price,
	       p.sold_count,
	       p.created_at,
	       ph.upload_file_name AS uploadFileName,
	       (p.price * p.sold_count) AS revenue
		FROM product p
		JOIN product_photos ph ON p.id = ph.product_id
		ORDER BY p.id
	</select>
	
	<!-- 날짜 필터 -->
	<select id="selectProductList" resultType="com.guideyou.dto.product.ProductDto">
		SELECT p.id AS productId, p.intro_content, p.content, p.price,
	       p.sold_count, p.created_at,
	       ph.upload_file_name AS uploadFileName,
	       (p.price * p.sold_count) AS revenue
		FROM product p
		JOIN product_photos ph ON p.id = ph.product_id AND ph.thumbnail IS NOT NULL
		WHERE 1=1
		<if test='selectedValue != null and selectedValue.equals("1")'>
		  and p.created_at <![CDATA[>=]]> date_format(now(),'%Y-%m-%d 00:00:00') and p.created_at <![CDATA[<=]]> date_format(now(),'%Y-%m-%d 23:59:59')
		</if>
		<if test='selectedValue != null and selectedValue.equals("2")'>
		  and p.created_at <![CDATA[>=]]> date_format(now(),'%Y-%m-01 00:00:00') and p.created_at <![CDATA[<]]> date_format(DATE_ADD(now(),INTERVAL 1 MONTH),'%Y-%m-01 00:00:00')
		</if>
		<if test='selectedValue != null and selectedValue.equals("3")'>
		  and p.created_at <![CDATA[>=]]> date_format(now(),'%Y-01-01 00:00:00') and p.created_at <![CDATA[<]]> date_format(DATE_ADD(now(),INTERVAL 1 year),'%Y-01-01 00:00:00')
		</if>
		ORDER BY p.id
	</select>
	
	<!-- 판매 된 상품 개수 조회 -->
	<select id="selectPaymentInfo" resultType="com.guideyou.dto.admin.AdminDto">
		select count(*) as paymentCount from payment
	</select>
	
	<!-- 총 판매 금액 조회 -->
	<select id="selectTotalPriceInfo" resultType="com.guideyou.dto.admin.AdminDto">
		select sum(total_price) as totalPrice from payment
	</select>
	
	<!-- 가입자 수 조회 -->
	<select id="selectTotalUserInfo" resultType="com.guideyou.dto.admin.AdminDto">
		select count(*) as userCount from user
	</select>
	
	<!-- 게시글 조회 -->
	<select id="selectBoardList" resultType="com.guideyou.dto.admin.BoardDto">
		select id, `type`, title, content from board_contents
	</select>
	
	
	
	
</mapper>