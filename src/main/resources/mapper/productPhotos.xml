<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guideyou.repository.interfaces.ProductPhotosRepository">

	<insert id="insert">
		insert into product_photos(product_id, product_photo_path, origin_file_name, upload_file_name)
		values(#{productId}, #{productPhotoPath}, #{originFileName}, #{uploadFileName})
	</insert>

	<update id="updateById">
		update product_photos set product_photo = #{productPhoto}, origin_file_name = #{originFileName}, 
		upload_file_name = #{uploadFileName} where product_id = #{productId}
	</update>

	<delete id="deleteByPhoto">
		delete from product_photos where product_id = #{productId}
	</delete>
	
	<delete id="deleteMutiPhoto">
		 delete from product_photos where id = #{id}	     
	</delete>	
	
	<select id="findAllByProductId" resultType="com.guideyou.dto.ProductSaveFormDto">
		select * from product_photos where product_id = #{productId}
	</select>
	
	<select id="findByProductId" resultType="com.guideyou.repository.entity.ProductPhotos">
		select * from product_photos where product_id = #{id}
	</select>
	
	<select id="findAll" resultType="com.guideyou.repository.entity.ProductPhotos">
		select * from product_photos
	</select>
	
	<select id="findPhoto" resultType="com.guideyou.repository.entity.ProductPhotos">
		SELECT upload_file_name FROM product_photos WHERE product_id = #{productId} ORDER BY created_at DESC LIMIT 1
	</select>
	
	<select id="selectPhotoList" resultType="com.guideyou.dto.ProductSaveFormDto">
		SELECT p.*, pi.upload_file_name AS uploadFileName
	    FROM product p
	    LEFT JOIN product_photos pi ON p.id = pi.product_id
	    GROUP BY p.id
	    ORDER BY pi.created_at DESC
	</select>
	
</mapper>